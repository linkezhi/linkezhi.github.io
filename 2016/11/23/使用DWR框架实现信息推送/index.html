<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="JAVA,DWR," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Dwr介绍
能使java后台和前端javascript互相调用的java库

近期的项目需要实现服务端实时推送信息到浏览器并异步更新的功能，之前实现类似功能是用ajax轮询的方法，即浏览器页面每隔一段时间向服务器发送ajax请求，然后后台返回数据给浏览器更新页面。这种方法缺点是连续不断的请求会占用服务器大量的资源，而且服务器是被动地回应请求并返回数据而不是主动推送数据。dwr有个特性叫Revers">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Dwr框架实现信息推送">
<meta property="og:url" content="https://linkezhi.github.io/2016/11/23/使用DWR框架实现信息推送/index.html">
<meta property="og:site_name" content="Z博客">
<meta property="og:description" content="Dwr介绍
能使java后台和前端javascript互相调用的java库

近期的项目需要实现服务端实时推送信息到浏览器并异步更新的功能，之前实现类似功能是用ajax轮询的方法，即浏览器页面每隔一段时间向服务器发送ajax请求，然后后台返回数据给浏览器更新页面。这种方法缺点是连续不断的请求会占用服务器大量的资源，而且服务器是被动地回应请求并返回数据而不是主动推送数据。dwr有个特性叫Revers">
<meta property="og:image" content="https://linkezhi.github.io/img/QQ图片20161124140541.png">
<meta property="og:image" content="https://linkezhi.github.io/img/QQ图片20161124140730.png">
<meta property="og:updated_time" content="2017-03-27T02:49:58.586Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用Dwr框架实现信息推送">
<meta name="twitter:description" content="Dwr介绍
能使java后台和前端javascript互相调用的java库

近期的项目需要实现服务端实时推送信息到浏览器并异步更新的功能，之前实现类似功能是用ajax轮询的方法，即浏览器页面每隔一段时间向服务器发送ajax请求，然后后台返回数据给浏览器更新页面。这种方法缺点是连续不断的请求会占用服务器大量的资源，而且服务器是被动地回应请求并返回数据而不是主动推送数据。dwr有个特性叫Revers">
<meta name="twitter:image" content="https://linkezhi.github.io/img/QQ图片20161124140541.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://linkezhi.github.io/2016/11/23/使用DWR框架实现信息推送/"/>

  <title> 使用Dwr框架实现信息推送 | Z博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Z博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hello World</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                使用Dwr框架实现信息推送
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-23T10:31:34+08:00" content="2016-11-23">
              2016-11-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/23/使用DWR框架实现信息推送/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/23/使用DWR框架实现信息推送/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Dwr介绍"><a href="#Dwr介绍" class="headerlink" title="Dwr介绍"></a>Dwr介绍</h3><blockquote>
<p>能使java后台和前端javascript互相调用的java库</p>
</blockquote>
<p>近期的项目需要实现服务端实时推送信息到浏览器并异步更新的功能，之前实现类似功能是用ajax轮询的方法，即浏览器页面每隔一段时间向服务器发送ajax请求，然后后台返回数据给浏览器更新页面。这种方法缺点是连续不断的请求会占用服务器大量的资源，而且服务器是被动地回应请求并返回数据而不是主动推送数据。<br>dwr有个特性叫Reverse Ajax（逆向Ajax），即从服务端主动向多个浏览器推送数据的技术。这个功能刚好满足需求，本文就使用dwr实现信息推送功能做个案例讲解。<br> <a id="more"></a></p>
<hr>
<h3 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h3><p>环境：<br>JDK 1.8<br>Tomcat 8.0<br>Window 7</p>
<p>支持jar包：<br>dwr3.0.jar<br>commons-logging-1.2.jar<br><a href="http://pan.baidu.com/s/1hsLoDhy" target="_blank" rel="external">网盘下载</a></p>
<h3 id="案例讲解"><a href="#案例讲解" class="headerlink" title="案例讲解"></a>案例讲解</h3><h4 id="广播推送"><a href="#广播推送" class="headerlink" title="广播推送"></a>广播推送</h4><ol>
<li>新建Web工程，将jar包下载后导入web项目中</li>
<li><p>配置web.xml </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">    <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xmlns:web</span>=<span class="string">"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></div><div class="line">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></div><div class="line">    <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 指定DWR核心Servlet的名字 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dwr<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!-- 指定DWR核心Servlet的实现类 --&gt;</span>org.directwebremoting.servlet.DwrServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 指定DWR核心Servlet处于调试状态 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 设置使用反向Ajax技术 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>activeReverseAjaxEnabled<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--长连接只保持时间 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>maxWaitAfterWrite<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 允許跨域 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>crossDomainSessionSecurity<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>allowScriptTagRemoting<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>classes<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>java.lang.Object<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>initApplicationScopeCreatorsAtStartup<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>logLevel<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>WARN<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dwr<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/dwr/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>Receive.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--  注册一个监听器类,用来启动推送信息的线程--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>dwr.SessionCreateListen<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>后台代码</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> dwr;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.directwebremoting.Browser;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ScriptSession;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ScriptSessionFilter;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ScriptSessions;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 在dwr.xml中注册该类后，dwr将会自动生成js文件。前端页面引入js文件后javascript与后台java的函数能互相调用</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DwrPushMessage</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> DwrPushMessage dwrPushMessage;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">pushMessageToClient</span><span class="params">(String message)</span> </span>&#123;</div><div class="line">		pushMessage(message);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">pushMessage</span><span class="params">(String message)</span> </span>&#123;</div><div class="line">		Browser.withAllSessionsFiltered(<span class="keyword">new</span> ScriptSessionFilter() &#123;</div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(ScriptSession session)</span> </span>&#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;, <span class="keyword">new</span> Runnable() &#123;</div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">				System.out.println(<span class="string">"推送信息："</span> + message);</div><div class="line">				<span class="comment">// 调用前端页面receiveMessages函数</span></div><div class="line">				ScriptSessions.addFunctionCall(<span class="string">"receiveMessages"</span>, message);</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>新建一个监听类用于开启推送信息的线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> dwr;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionAttributeListener;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingEvent;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.Container;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ServerContextFactory;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.extend.ScriptSessionManager;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionCreateListen</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent ev)</span> </span>&#123;</div><div class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> PushMessageRunnable()).start();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent ev)</span> </span>&#123;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125; </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PushMessageRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;			</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				Thread.sleep(<span class="number">3000</span>);</div><div class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">				<span class="comment">// TODO Auto-generated catch block</span></div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">			DwrPushMessage.pushMessageToClient(<span class="string">"来自服务端的数据:"</span> + System.currentTimeMillis());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>配置dwr.xml<br>新建dwr.xml 在WEB-INF目录下<br>dwr将会根据该配置文件把代理类生成js代码给前端调用</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  </div><div class="line"><span class="meta">&lt;!DOCTYPE dwr PUBLIC   </span></div><div class="line"> "-//GetAhead Limited//DTD Direct Web Remoting 1.0//EN"   </div><div class="line"> "http://www.getahead.ltd.uk/dwr/dwr10.dtd"&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">dwr</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">allow</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">create</span> <span class="attr">creator</span>=<span class="string">"new"</span> <span class="attr">javascript</span>=<span class="string">"DwrPushMessage"</span> <span class="attr">scope</span>=<span class="string">"application"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"class"</span> <span class="attr">value</span>=<span class="string">"dwr.DwrPushMessage"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">create</span>&gt;</span> </div><div class="line">    <span class="tag">&lt;/<span class="name">allow</span>&gt;</span>       </div><div class="line"><span class="tag">&lt;/<span class="name">dwr</span>&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li>前端页面代码</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>starting page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dwr/engine.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dwr/util.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dwr/interface/DwrPushMessage.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 这三个js都是由dwr的servlet生成 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- dwr根据dwr.xml的配置自动生成DwrPushMessage.js,是dwr生成的DwrPushMessage.java的前台代理类 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- 需要注意的是，util.js中也运用$来操作dom，和jquery同时使用时存在多库共存问题，需要注意“$”符的控制权问题 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line">    /* 接受消息方法的前台代理 函数*/</div><div class="line">    function receiveMessages(messages) &#123;</div><div class="line">    	var lastMessage = messages;</div><div class="line">    	console.log(messages);</div><div class="line">    	var ul = document.getElementById("list");</div><div class="line">    	var li = document.createElement("li");</div><div class="line">    	li.innerHTML = lastMessage;</div><div class="line">    	ul.appendChild(li);</div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- onload方法开启逆向Ajax --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"dwr.engine.setActiveReverseAjax(true);"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>接收服务器广播信息<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<hr>
<p>页面效果<br><img src="/img/QQ图片20161124140541.png" alt="enter description here" title="1479887645308.jpg"></p>
<h4 id="精确推送"><a href="#精确推送" class="headerlink" title="精确推送"></a>精确推送</h4><p>dwr在页面链接后台时会创建一个ScriptSession对象，推送时可以在相应的scriptSession中添加“name“属性来区分推送的目标。</p>
<ol>
<li>后台代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Collection;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.Browser;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ScriptBuffer;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ScriptSession;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ScriptSessionFilter;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ScriptSessions;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.WebContextFactory;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 精确推送代理类</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccurDwrPushMessage</span> </span>&#123;</div><div class="line">		<span class="comment">//前端js函数名称</span></div><div class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FORNT_METHOD_NAME = <span class="string">"accurReceiveMessages"</span>;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SESSION_ATTRIBUTE_NAME =<span class="string">"userId"</span>;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">static</span> AccurDwrPushMessage AccurDwrPushMessage;</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">pushMessageToClient</span><span class="params">(String id,String message)</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span>(AccurDwrPushMessage == <span class="keyword">null</span>)&#123;</div><div class="line">				AccurDwrPushMessage = <span class="keyword">new</span> AccurDwrPushMessage();</div><div class="line">			&#125;</div><div class="line">			AccurDwrPushMessage.pushMessage(id,message);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushMessage</span><span class="params">(String userid, String message)</span> </span>&#123;</div><div class="line">	        <span class="keyword">final</span> String userId = userid;</div><div class="line">	        <span class="keyword">final</span> String autoMessage = message;</div><div class="line">	        Browser.withAllSessionsFiltered(<span class="keyword">new</span> ScriptSessionFilter() &#123;</div><div class="line">	            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(ScriptSession session)</span></span>&#123;</div><div class="line">	                <span class="keyword">if</span> (session.getAttribute(SESSION_ATTRIBUTE_NAME) == <span class="keyword">null</span>)&#123;</div><div class="line">	                	<span class="keyword">return</span> <span class="keyword">false</span>;                	</div><div class="line">	                &#125;</div><div class="line">	                <span class="keyword">else</span>&#123;                	</div><div class="line">	                    <span class="keyword">return</span> (session.getAttribute(SESSION_ATTRIBUTE_NAME)).equals(userId);</div><div class="line">	                &#125;                	</div><div class="line">	            &#125;</div><div class="line">	        &#125;, <span class="keyword">new</span> Runnable()&#123;            </div><div class="line">	            <span class="keyword">private</span> ScriptBuffer script = <span class="keyword">new</span> ScriptBuffer();            </div><div class="line">	            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;               </div><div class="line">	                script.appendCall(FORNT_METHOD_NAME, autoMessage);                </div><div class="line">	                Collection&lt;ScriptSession&gt; sessions = Browser.getTargetSessions();                </div><div class="line">	                <span class="keyword">for</span> (ScriptSession scriptSession : sessions)&#123;</div><div class="line">	                   <span class="comment">/* scriptSession.addScript(script);*/</span></div><div class="line">	                    <span class="keyword">if</span> (scriptSession.getAttribute(SESSION_ATTRIBUTE_NAME).equals(userId)) &#123;</div><div class="line">	                        scriptSession.addScript(script);</div><div class="line">	                        System.out.println(<span class="string">"pushMessage:"</span>+scriptSession.getAttribute(SESSION_ATTRIBUTE_NAME));</div><div class="line">	                    &#125;</div><div class="line">	                &#125;</div><div class="line">	            &#125;</div><div class="line">	        &#125;);</div><div class="line">	    &#125;&#125;</div></pre></td></tr></table></figure>
<p>注册id的代理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.Container;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ScriptSession;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.ServerContextFactory;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.WebContextFactory;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.event.ScriptSessionEvent;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.event.ScriptSessionListener;</div><div class="line"><span class="keyword">import</span> org.directwebremoting.extend.ScriptSessionManager;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *添加session</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DwrRegistUtil</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerAccout</span><span class="params">(String userId)</span> </span>&#123;</div><div class="line">		ScriptSession scriptSession = WebContextFactory.get().getScriptSession();</div><div class="line">		scriptSession.setAttribute(<span class="string">"userId"</span>, userId);</div><div class="line">		Container container = ServerContextFactory.get().getContainer();</div><div class="line">        ScriptSessionManager manager = container.getBean(ScriptSessionManager.class);</div><div class="line">        ScriptSessionListener listener = <span class="keyword">new</span> ScriptSessionListener() &#123;</div><div class="line">               <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(ScriptSessionEvent ev)</span> </span>&#123;</div><div class="line">                      HttpSession session = WebContextFactory.get().getSession();</div><div class="line">                      String userId =session.getAttribute(<span class="string">"userId"</span>)+<span class="string">""</span>;</div><div class="line">                      System.out.println(<span class="string">"a ScriptSession is created!  userId:"</span>+userId);</div><div class="line">                      ev.getSession().setAttribute(<span class="string">"userId"</span>, userId);</div><div class="line">               &#125;</div><div class="line">               <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(ScriptSessionEvent ev)</span> </span>&#123;</div><div class="line">                      System.out.println(<span class="string">"a ScriptSession is distroyed"</span>);</div><div class="line">               &#125;</div><div class="line">        &#125;;</div><div class="line">        manager.addScriptSessionListener(listener);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>dwr.xml 添加配置项</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  </div><div class="line"><span class="meta">&lt;!DOCTYPE dwr PUBLIC   </span></div><div class="line"> "-//GetAhead Limited//DTD Direct Web Remoting 1.0//EN"   </div><div class="line"> "http://www.getahead.ltd.uk/dwr/dwr10.dtd"&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">dwr</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">allow</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">create</span> <span class="attr">creator</span>=<span class="string">"new"</span> <span class="attr">javascript</span>=<span class="string">"DwrPushMessage"</span> <span class="attr">scope</span>=<span class="string">"application"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"class"</span> <span class="attr">value</span>=<span class="string">"dwr.DwrPushMessage"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">create</span>&gt;</span> </div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">create</span> <span class="attr">creator</span>=<span class="string">"new"</span> <span class="attr">javascript</span>=<span class="string">"DwrRegistUtil"</span> <span class="attr">scope</span>=<span class="string">"application"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"class"</span> <span class="attr">value</span>=<span class="string">"dwr.DwrRegistUtil"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">create</span>&gt;</span> </div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">create</span> <span class="attr">creator</span>=<span class="string">"new"</span> <span class="attr">javascript</span>=<span class="string">"AccurDwrPushMessage"</span> <span class="attr">scope</span>=<span class="string">"application"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"class"</span> <span class="attr">value</span>=<span class="string">"dwr.AccurDwrPushMessage"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">create</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;/<span class="name">allow</span>&gt;</span></div><div class="line">          </div><div class="line"><span class="tag">&lt;/<span class="name">dwr</span>&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li>前端代码</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">import</span>=<span class="string">"java.util.*"</span> <span class="attr">pageEncoding</span>=<span class="string">"utf-8"</span>%&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>starting page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dwr/engine.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dwr/util.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dwr/interface/DwrPushMessage.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dwr/interface/DwrRegistUtil.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dwr/interface/AccurDwrPushMessage.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- dwr根据dwr.xml的配置自动生成DwrPushMessage.js,是dwr生成的DwrPushMessage.java的前台代理类 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- 需要注意的是，util.js中也运用$来操作dom，和jquery同时使用时存在多库共存问题，需要注意“$”符的控制权问题 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="xml"></span></div><div class="line">var LocalUserId ;</div><div class="line">//读取name值作为推送的唯一标示</div><div class="line">function registed()&#123;</div><div class="line">    // 获取URL中的name属性为唯一标识符</div><div class="line">    var account = document.getElementById("account").value;</div><div class="line">    // 通过代理，传入区别本页面的唯一标识符</div><div class="line">    DwrRegistUtil.registerAccout(account);</div><div class="line">    document.getElementById("userID").innerHTML=account;</div><div class="line">    LocalUserId = account;</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> function sendToReceive()&#123;</div><div class="line">	// 获取URL中的name属性为唯一标识符</div><div class="line">	    var account = document.getElementById("recevierId").value;</div><div class="line">	    // 通过代理，传入区别本页面的唯一标识符</div><div class="line">	    var message = '$&#123;sessionScope.userId&#125;';</div><div class="line">	    AccurDwrPushMessage.pushMessage(account,"来自"+LocalUserId+"的信息");</div><div class="line"> &#125;</div><div class="line">    /* 接受消息方法的前台代理 函数*/</div><div class="line">    function receiveMessages(messages) &#123;</div><div class="line">    	var lastMessage = messages;</div><div class="line">    	console.log(messages);</div><div class="line">    	var ul = document.getElementById("list");</div><div class="line">    	var li = document.createElement("li");</div><div class="line">    	li.innerHTML = lastMessage;</div><div class="line">    	ul.appendChild(li);</div><div class="line">    &#125; </div><div class="line">    </div><div class="line">    /* 精确传送 接受消息方法的前台代理 */</div><div class="line">    function accurReceiveMessages(messages) &#123;</div><div class="line">    	console.log(messages);</div><div class="line">    	var lastMessage = messages;</div><div class="line">    	var ul = document.getElementById("list2");</div><div class="line">    	var li = document.createElement("li");</div><div class="line">    	li.innerHTML = lastMessage;</div><div class="line">    	ul.appendChild(li);</div><div class="line">    	/* li.innerHTML = lastMessage;</div><div class="line">    	ul.appendChild(li);</div><div class="line">        for ( var data in messages) &#123;</div><div class="line">            messageList = "<span class="tag">&lt;<span class="name">div</span>&gt;</span>" + dwr.util.escapeHtml(messages[data]) + "<span class="tag">&lt;/<span class="name">div</span>&gt;</span>" + messageList;</div><div class="line">        &#125;</div><div class="line">        dwr.util.setValue("list2", messageList, &#123;</div><div class="line">            escapeHtml : false</div><div class="line">        &#125;); */</div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- onload方法开启逆向Ajax --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"dwr.engine.setActiveReverseAjax(true);dwr.engine.setNotifyServerOnPageUnload(true);"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>我的id为<span class="tag">&lt;<span class="name">b</span> <span class="attr">id</span>=<span class="string">"userID"</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"account"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"registed()"</span> <span class="attr">value</span>=<span class="string">"注册"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">    接收者id:<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"recevierId"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"sendToReceive()"</span> <span class="attr">value</span>=<span class="string">"发送"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">br</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"clear:both"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"float:left; width:500px ;"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>接收服务器广播信息<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">div</span> <span class="attr">style</span>=<span class="string">"float:left; width:500px ;"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>接收客户端的单点信息<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list2"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li>页面效果<br><img src="/img/QQ图片20161124140730.png" alt="enter description here" title="1479957142590.jpg"></li>
</ol>
<h4 id="案例代码"><a href="#案例代码" class="headerlink" title="案例代码"></a>案例代码</h4><p><a href="https://github.com/linkezhi/dwr" target="_blank" rel="external">dwr demo</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JAVA/" rel="tag">#JAVA</a>
          
            <a href="/tags/DWR/" rel="tag">#DWR</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/09/11/GPS坐标转换为百度地图坐标/" rel="next" title="GPS坐标转换为百度地图坐标">
                <i class="fa fa-chevron-left"></i> GPS坐标转换为百度地图坐标
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/23/使用DWR框架实现信息推送/"
           data-title="使用Dwr框架实现信息推送" data-url="https://linkezhi.github.io/2016/11/23/使用DWR框架实现信息推送/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="linkezhi" />
          <p class="site-author-name" itemprop="name">linkezhi</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">4</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dwr介绍"><span class="nav-number">1.</span> <span class="nav-text">Dwr介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#前期准备"><span class="nav-number">2.</span> <span class="nav-text">前期准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#案例讲解"><span class="nav-number">3.</span> <span class="nav-text">案例讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#广播推送"><span class="nav-number">3.1.</span> <span class="nav-text">广播推送</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#精确推送"><span class="nav-number">3.2.</span> <span class="nav-text">精确推送</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#案例代码"><span class="nav-number">3.3.</span> <span class="nav-text">案例代码</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">linkezhi</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"linkezhi"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
